<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>enroll</title>
    <link rel="stylesheet" href="/css/realEnroll.css">
</head>
<body>
    <hr>
    <div>
        <span id="title">어쩌고 대학교 수강신청</span>
    </div>

    <div class="studentInfo">
        <div id="form">
            <span>님의 정보</span>
        </div>


    </div>
    <hr>
    <div>
        <div>
            <span>과목정보 검색하기</span>
            <div class="infoContent">
                <div>
                    <span>직접입력</span>
                    <form action="/search/sub" method="GET">
                        <div class="row g-1">
                            <div class="input-group mb-3" id="inputParent">
                                <select class="form-select" name="searchType">
                                    <option value="과목명" selected >과목명</option>
                                    <option value="교수명">교수명</option>
                                    <option value="과목코드">과목코드</option>
                                    <option value="학과/학부">학과/학부</option>
                                </select>
                                <input type="text" id="searchSub" class="form-control" >
                                <button type="submit" id="searchSubBtn1" class="btn btn-outline-secondary">과목검색</button>
                            </div>
                        </div>
                    </form>
                </div>

                <div>
                    <span>과목찾기</span>
                    <form action="/search/sub" method="GET">
                        <div class="row g-3">
                            <div class="col-md">
                                <div class="form-floating">
                                    <select class="form-select" name="semester">
                                        <option value="1학기 정규학기" selected >1학기 정규학기</option>
                                        <option value="2학기 정규학기" >2학기 정규학기</option>
                                        <option value="여름 계절학기" >여름 계절학기</option>
                                        <option value="겨울 계절학기">겨울 계절학기</option>
                                    </select>
                                    <label>학기</label>
                                </div>
                            </div>
                            <div class="col-md">
                                <div class="form-floating">
                                    <select class="form-select" name="major" >
                                        <option value="심리학과"  selected>심리학과</option>
                                        <option value="컴퓨터공학과"  >컴퓨터공학과</option>
                                        <option value="통계학과">통계학과</option>
                                        <option value="경영학과">경영학과</option>
                                    </select>
                                    <label>학과</label>
                                </div>
                            </div>
                            <div class="col-md">
                                <div class="form-floating">
                                    <select class="form-select" name="subjectType" >
                                        <option value="전공기초" selected>전공기초</option>
                                        <option value="전공선택">전공선택</option>
                                        <option value="전공필수">전공필수</option>
                                        <option value="교양선택">교양선택</option>
                                        <option value="교양필수">교양필수</option>
                                    </select>
                                    <label>과목유형</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md">
                            <div class="form-floating">
                                <button type="submit" id="searchSubBtn2" class="btn btn-outline-secondary">과목검색</button>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
            <div class="infoContent">
                <div id="go">
                    <span>▼</span><br>
                    <span>검색결과</span>
                </div>
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th scope="col">과목코드</th>
                        <th scope="col">과목명</th>
                        <th scope="col">과목타입</th>
                        <th scope="col">교수명</th>
                        <th scope="col">학점</th>
                        <th scope="col">총수강인원</th>
                        <th scope="col">강의실</th>
                        <th scope="col">시간</th>
                        <th scope="col">과목평점</th>
                    </tr>
                    </thead>
                    <tbody id="inputSubInfo">


                    </tbody>
                </table>
            </div>
            </section>
        </div>
        <hr>
        <div>
            <span>수강신청하기</span>
            <div>
                <form action="/search/sub" method="GET">
                    <div class="row g-1">
                        <div class="input-group mb-2" id="">

                            <input type="text" id="subCode" class="form-control" placeholder="과목코드를 입력하세요">
                            <button type="submit" id="enrollBtn" class="btn btn-outline-secondary">수강신청</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script>

        let stu_code;
        //로그인 상태에 따른 화면 보여주기
        $.ajax({
            url:"/login/status",
            type:"GET", //로그인 상태정보를 조회하는 것이므로
            dataType:"text",
            success: function(Name){

                if(Name!=undefined){
                    $("#form").prepend("<span id=\"user\">"+Name+"</span>");

                    $.ajax({
                        url:"/search/stu",
                        type: "POST",
                        success: function (json) {
                            alert("학생정보받아옴")
                            let stuInfoList = json.list;

                            stuInfoList = stuInfoList[1];

                                stu_code = stuInfoList.stu_code;
                                let stu_name = stuInfoList.stu_name;
                                let id = stuInfoList.id;
                                let pw = stuInfoList.pw;
                                let birthday = stuInfoList.birthday;
                                let major = stuInfoList.major;
                                let minor = stuInfoList.minor;
                                let mobile = stuInfoList.mobile;
                                let email = stuInfoList.email;
                                let addr = stuInfoList.addr;
                                let avg_grade = stuInfoList.avg_grade;
                                let enterdate = stuInfoList.enterdate;
                                let semester = stuInfoList.semester;


                                $("#form").append("<br><span>" + stu_code +  "</span><br>")
                                $("#form").append("<span>" + stu_name +  "</span><br>")
                                $("#form").append("<span>" + id +  "</span><br>")
                                $("#form").append("<span>" + pw +  "</span><br>")
                                $("#form").append("<span>" + birthday +  "</span><br>")
                                $("#form").append("<span>" + major +  "</span><br>")
                                $("#form").append("<span>" + minor +  "</span><br>")
                                $("#form").append("<span>" + mobile +  "</span><br>")
                                $("#form").append("<span>" + email +  "</span><br>")
                                $("#form").append("<span>" + addr +  "</span><br>")
                                $("#form").append("<span>" + avg_grade +  "</span><br>")
                                $("#form").append("<span>" + enterdate +  "</span><br>")
                                $("#form").append("<span>" + semester +  "</span><br>")


                        },
                        error: function (){
                            alert("학생정보 받아오기 실패")
                        }
                    })

                    //학적 가지고 오기
                }else{
                }
            },
            error: function(){

            }
        });



        $("#searchSubBtn1").on("click", function (){
            event.preventDefault();
            let $searchType = $("select[name=searchType]");
            let searchType = $searchType.val();
            let $searchSub = $("#searchSub");
            let searchSub = $searchSub.val();
            searchSub = searchSub.replace(/\s/gi, "");
            alert(searchSub);
            $.ajax({
                url:"/search/sub",
                data: "searchType="+searchType+"&searchSub="+searchSub,
                success: function (json){
                    $(".result").remove();
                    if(json == undefined){
                        $("#inputSubInfo").append("<tr class=\"result\">\n" +
                            "                            <td colspan=\"9\"><span>검색내역이 없습니다. </span></td>\n" +
                            "                        </tr>")
                    }else{
                        let subInfoList = json.list;

                        for(let i=0; i<subInfoList.length; i++){
                            let nthSubInfo = subInfoList[i];
                            let sub_code = nthSubInfo.sub_code;
                            let sub_name = nthSubInfo.sub_name;
                            let sub_type = nthSubInfo.sub_type;
                            let pro_name = nthSubInfo.pro_name;
                            let grade = nthSubInfo.grade;
                            let stu_num = nthSubInfo.stu_num;
                            let major_stu_num = nthSubInfo.major_stu_num;
                            let minor_stu_num = nthSubInfo.minor_stu_num;
                            let general_stu_num = nthSubInfo.general_stu_num;
                            let place = nthSubInfo.place;
                            let time = nthSubInfo.time;
                            let rating = nthSubInfo.rating;

                            $("#inputSubInfo").append("<tr class=\"result\">\n" +
                                "                            <th scope=\"row\">" + sub_code + "</th>\n" +
                                "                            <td>" + sub_name + "</td>\n" +
                                "                            <td>" + sub_type + "</td>\n" +
                                "                            <td>" + pro_name + "</td>\n" +
                                "                            <td>" + grade + "</td>\n" +
                                "                            <td id=\"detailStuNum\"><div class=\"dropdown\"><div>" + stu_num + "</div><ul class=\"dropdown-menu\">\n" +
                                "  <li>전공인원: " + major_stu_num + "</li>\n" +
                                "  <li>부/복수전공인원: " + minor_stu_num + "</li>\n" +
                                "  <li>일반선택인원: " + general_stu_num + "</li>\n" +
                                "</ul></div></td>\n" +
                                "                            <td>" + place + "</td>\n" +
                                "                            <td>" + time + "</td>\n" +
                                "                            <td>" + rating + "</td>\n" +
                                "                        </tr>")
                            $(".dropdown-menu").css('display', 'none');
                            $(".dropdown").on("mouseenter", function (){
                                $(".dropdown-menu").css('display', 'block');
                            })
                            $(".dropdown").on("mouseleave", function (){
                                $(".dropdown-menu").css('display', 'none');
                            })
                        }
                    }
                },error: function (){
                    alert("오류");
                }
            })
        });

        $("#searchSubBtn2").on("click", function (){
            event.preventDefault();
            let $semester = $("select[name=semester]");
            let semester = $semester.val();
            let $major = $("select[name=major]");
            let major = $major.val();
            let $subjectType = $("select[name=subjectType]");
            let subjectType = $subjectType.val();

            $.ajax({
                url:"/search/sub",
                data: "semester="+semester+"&major="+major+"&subjectType="+subjectType,
                success: function (json){
                    $(".result").remove();
                    if(json == undefined){
                        $("#inputSubInfo").append("<tr class=\"result\">\n" +
                            "                            <td colspan=\"9\"><span>검색내역이 없습니다. </span></td>\n" +
                            "                        </tr>")
                    }else{
                        let subInfoList = json.list;

                        for(let i=0; i<subInfoList.length; i++){
                            let nthSubInfo = subInfoList[i];
                            let sub_code = nthSubInfo.sub_code;
                            let sub_name = nthSubInfo.sub_name;
                            let sub_type = nthSubInfo.sub_type;
                            let pro_name = nthSubInfo.pro_name;
                            let grade = nthSubInfo.grade;
                            let stu_num = nthSubInfo.stu_num;
                            let major_stu_num = nthSubInfo.major_stu_num;
                            let minor_stu_num = nthSubInfo.minor_stu_num;
                            let general_stu_num = nthSubInfo.general_stu_num;
                            let place = nthSubInfo.place;
                            let time = nthSubInfo.time;
                            let rating = nthSubInfo.rating;

                            $("#inputSubInfo").append("<tr class=\"result\">\n" +
                                "                            <th scope=\"row\">" + sub_code + "</th>\n" +
                                "                            <td>" + sub_name + "</td>\n" +
                                "                            <td>" + sub_type + "</td>\n" +
                                "                            <td>" + pro_name + "</td>\n" +
                                "                            <td>" + grade + "</td>\n" +
                                "                            <td id=\"detailStuNum\"><div class=\"dropdown\"><div>" + stu_num + "</div><ul class=\"dropdown-menu\">\n" +
                                "  <li>전공인원: " + major_stu_num + "</li>\n" +
                                "  <li>부/복수전공인원: " + minor_stu_num + "</li>\n" +
                                "  <li>일반선택인원: " + general_stu_num + "</li>\n" +
                                "</ul></div></td>\n" +
                                "                            <td>" + place + "</td>\n" +
                                "                            <td>" + time + "</td>\n" +
                                "                            <td>" + rating + "</td>\n" +
                                "                        </tr>")
                            $(".dropdown-menu").css('display', 'none');
                            $(".dropdown").on("mouseenter", function (){
                                $(".dropdown-menu").css('display', 'block');
                            })
                            $(".dropdown").on("mouseleave", function (){
                                $(".dropdown-menu").css('display', 'none');
                            })
                        }
                    }
                },error: function (){
                    alert("오류");
                }
            })
        });

        $("#enrollBtn").on("click", function (event){
            event.preventDefault();

            let $sub_code = $("#subCode");
            let sub_code = $sub_code.val();
            sub_code = sub_code.replace(/\s/gi, "");
            alert(sub_code);
            alert(stu_code);
            $.ajax({
                url:"/enroll",
                data: "sub_code="+sub_code+"&stu_code="+stu_code,
                success: function (){



                },error: function (){
                    alert("오류");
                }
            })
        });

    </script>
</body>
</html>